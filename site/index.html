<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Edge Rails.info :: Articles</title>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type' />
    <meta content='2mKA7BQdzoMID17KsbMUeJRDNiJ014GEDJ5f1XTyKVg' name='google-site-verification' />
    <link href='/stylesheets/screen.css' media='screen, projection' rel='stylesheet' type='text/css' />
    <link href='/atom.xml' rel='alternate' title='Edge Rails.info' type='application/atom+xml' />
    <script src='http://www.google.com/jsapi?key=ABQIAAAAy8pbLvXSAhT6CrI93EHftRR2Vx9IrckWRbFszzbqrF7HPRyGLxRbhX5HmXRQATF-75QozHQ-TWk5Mw' type='text/javascript'></script>
    <script src='http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js' type='text/javascript'></script>
    <script src='/javascripts/jquery.setup.js' type='text/javascript'></script>
    <script src='/javascripts/json2.js' type='text/javascript'></script>
    <script src='/javascripts/jquery.template.js' type='text/javascript'></script>
    <script src='/javascripts/jquery.cookie.js' type='text/javascript'></script>
    <script src='/javascripts/jquery.prettydate.js' type='text/javascript'></script>
    <script src='/javascripts/jquery.twitter.js' type='text/javascript'></script>
    <script src='/javascripts/jquery.feed.js' type='text/javascript'></script>
    <script src='/javascripts/jquery.googlesearch.js' type='text/javascript'></script>
    <script src='/javascripts/jquery.search.js' type='text/javascript'></script>
    <script type='text/javascript'>
      //<![CDATA[
        google.load("feeds", "1");
        google.setOnLoadCallback(function() {
          $('div.feed').feedme();
        });
      //]]>
    </script>
  </head>
  <body class="articles" id="">
    <div id="header">
      <div class='page_width'>
        <a class='title' href='/'>Edge Rails.info</a>
      </div>
      <a href='/publish.html' id='fork'>Fork, Contribute, & Publish</a>
    </div>
    <div id="nav">
      <div class='page_width'>
        <ul>
          <li class='articles first'>
            <a href='/'>Articles</a>
          </li>
          <li class='about'>
            <a href='/about.html'>About</a>
          </li>
          <li class='publish last'>
            <a href='/publish.html'>Publishing Guide</a>
          </li>
          <li class='search'>
            <form cse='001155634542480541734:-pewsihppdg' id='google_search' results='#search_results'>
              <input class='search_field' size='10' type='text' />
            </form>
          </li>
          <li class='subscribe'>
            <a href='http://feeds.feedburner.com/edgerails'>Subscribe</a>
          </li>
        </ul>
      </div>
    </div>
    <div id="search">
      <div class='page_width'>
        <script type='text/javascript'>
          //<![CDATA[
            $(window).load(function() {
              $('#google_search').enableSearch();
            });
            function hideSearchResults() {
              $('#search_results').hide();
            }
          //]]>
        </script>
        <div class='hidden' id='search_results' template='#search_template'></div>
        <script id='search_template' type='text/html'>
          <div class="results">
            <h5>Search Results:</h5>
            <% if (results.length){ %>
            <ul>
              <% for ( var i = 0; i < results.length; i++ ) { %>
                <% var result = results[i]; %>
                <li>
                  <a href="<%= result.url %>"><%= result.titleNoFormatting %></a>
                <p><%= result.content %></p>
                </li>
              <% } %>
            </ul>
            <% } else { %>
              <strong>Oops! We couldn't find posts about that.</strong>
            <% } %>
            <a id="close_search" href="#" onClick="hideSearchResults(); return false;">close</a>
          </div>
        </script>
      </div>
    </div>
    <div id="page">
      <div class='page_width'>
        <div id='main'>
          <div class='contents'>
            <div class="blog">&#x000A;  <div class="article">&#x000A;    <h2><a class="title" href="/articles/what-s-new-in-edge-rails/2011/05/06/reversible-migrations">Reversible Migrations</a></h2>&#x000A;    <div class="meta">&#x000A;      posted: May 6th, 2011&#x000A;    </div>&#x000A;    <p><span class="version"><strong>Rails</strong> 3.1</span></p>&#x000A;&#x000A;<p>A killer feature of Ruby on Rails that has filled web developers with joy is Migrations. In Rails 3.1 Migrations have got a new trick up their sleeves that will make you even more happy. If you need a little refresher on what migrations are then I suggest reading the official <a href="http://guides.rubyonrails.org/migrations.html">Rails guide</a>.</p>&#x000A;&#x000A;<p>Lets start by looking at how a typical migration looks like in Rails 3.0</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>Ruby - db/migrate/20110505090317_create_posts.rb</em>&#x000A;<div class="highlight"><pre>  <span class="k">class</span> <span class="nc">CreatePosts</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>&#x000A;    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">up</span>&#x000A;      <span class="n">create_table</span> <span class="ss">:posts</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>&#x000A;        <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:title</span>&#x000A;        <span class="n">t</span><span class="o">.</span><span class="n">text</span> <span class="ss">:body</span>&#x000A;        &#x000A;        <span class="n">t</span><span class="o">.</span><span class="n">timestamps</span>&#x000A;      <span class="k">end</span>&#x000A;    <span class="k">end</span>&#x000A;    &#x000A;    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">down</span>&#x000A;      <span class="n">drop_table</span> <span class="ss">:posts</span>&#x000A;    <span class="k">end</span>&#x000A;  <span class="k">end</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>This migration creates a posts table with two fields &mdash; title and body of type string and text respectively. The timestamps helper creates datetime fields &mdash; created_at and updated_at for free. To reverse this migration we simply need to drop the posts table. The class method down does precisely this. When Rails is applying a migration it runs the class method up. To reverse the migration it runs the class method down.</p>&#x000A;&#x000A;<p>Two questions come up when you look at this migration &mdash;</p>&#x000A;&#x000A;<ul>&#x000A;  <li>&#x000A;    Why class methods instead of plain &#8216;old instance methods?&#x000A;  </li>&#x000A;  <li>&#x000A;    For simple cases why not just define the up migration and have Rails take care of reversing the migration?&#x000A;  </li>&#x000A;</ul>&#x000A;&#x000A;&#x000A;<p>The ever awesome <a href="http://www.tendorloving.com">Aaron Patterson</a> asked these questions and decided to simplify things for you and me.</p>&#x000A;&#x000A;<h3>Introducing change</h3>&#x000A;&#x000A;<p>If you run the following command in Edge Rails, the genarated migration will look something like the example below:</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>console</em>&#x000A;<div class="highlight"><pre>  <span class="o">(</span>~/code/migrahedron<span class="o">)</span>реп rails g model Post title:string body:text&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;&#x000A;&#x000A;<div class="code_window">&#x000A;<em>Ruby - db/migrate/20110505084530_create_posts.rb</em>&#x000A;<div class="highlight"><pre>  <span class="k">class</span> <span class="nc">CreatePosts</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>&#x000A;    <span class="k">def</span> <span class="nf">change</span>&#x000A;      <span class="n">create_table</span> <span class="ss">:posts</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>&#x000A;        <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:title</span>&#x000A;        <span class="n">t</span><span class="o">.</span><span class="n">text</span> <span class="ss">:body</span>&#x000A;  &#x000A;        <span class="n">t</span><span class="o">.</span><span class="n">timestamps</span>&#x000A;      <span class="k">end</span>&#x000A;    <span class="k">end</span>&#x000A;  <span class="k">end</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>By default Rails 3.1 will generate migrations for models using the change method that will hold the up logic. While trying to rollback, Rails will figure out how to reverse the migration for you. Go ahead and apply the migration and then rollback! You should see something like the following:</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>console</em>&#x000A;<div class="highlight"><pre>  <span class="o">(</span>~/code/migrahedron<span class="o">)</span>реп rake db:migrate&#x000A;  <span class="o">(</span>in /home/rohit/code/migrahedron<span class="o">)</span>&#x000A;  <span class="o">==</span>  CreatePosts: <span class="nv">migrating</span> <span class="o">====================================================</span>&#x000A;  -- create_table<span class="o">(</span>:posts<span class="o">)</span>&#x000A;     -&gt; 0.0012s&#x000A;  <span class="o">==</span>  CreatePosts: migrated <span class="o">(</span>0.0013s<span class="o">)</span> <span class="o">===========================================</span>&#x000A;  &#x000A;&#x000A;  <span class="o">(</span>~/code/migrahedron<span class="o">)</span>реп rake db:rollback&#x000A;  <span class="o">(</span>in /home/rohit/code/migrahedron<span class="o">)</span>&#x000A;  <span class="o">==</span>  CreatePosts: <span class="nv">reverting</span> <span class="o">====================================================</span>&#x000A;  -- drop_table<span class="o">(</span><span class="s2">&quot;posts&quot;</span><span class="o">)</span>&#x000A;     -&gt; 0.0007s&#x000A;  <span class="o">==</span>  CreatePosts: reverted <span class="o">(</span>0.0008s<span class="o">)</span> <span class="o">===========================================</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>Notice how Rails has figured out that in order to reverse the migration, it needs to drop the newly created table.</p>&#x000A;&#x000A;<h3>What about commands that can&#8217;t be reversed?</h3>&#x000A;&#x000A;<p>There are certain commands like remove_column that cannot be automatically reversed. This is because the information required to re-create the column is not available in the remove_column command. If Rails encounters such commands while reversing a migration, an ActiveRecord::IrreversibleMigration exception will be raised.</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>Ruby - db/migrate/20110505101449_remove_title_from_post.rb</em>&#x000A;<div class="highlight"><pre>  <span class="k">class</span> <span class="nc">RemoveTitleFromPost</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>&#x000A;    <span class="k">def</span> <span class="nf">change</span>&#x000A;      <span class="n">remove_column</span> <span class="ss">:posts</span><span class="p">,</span> <span class="ss">:title</span>&#x000A;    <span class="k">end</span>&#x000A;  <span class="k">end</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>If you try rolling back the above migration you will get something like:</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>console</em>&#x000A;<div class="highlight"><pre>  <span class="o">(</span>~/code/migrahedron<span class="o">)</span>реп rake db:rollback&#x000A;  <span class="o">(</span>in /home/rohit/code/migrahedron<span class="o">)</span>&#x000A;  <span class="o">==</span>  RemoveTitleFromPost: <span class="nv">reverting</span> <span class="o">============================================</span>&#x000A;  rake aborted!&#x000A;  An error has occurred, this and all later migrations canceled:&#x000A;  &#x000A;  ActiveRecord::IrreversibleMigration&#x000A;  &#x000A;  <span class="o">(</span>See full trace by running task with --trace<span class="o">)</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>If you want to handle such cases manually you can define the up and down methods <em>almost</em> like before.</p>&#x000A;&#x000A;<h3>Up and Down instance methods</h3>&#x000A;&#x000A;<p>The only change to the old up and down methods is that they are now instance methods. Say good bye to those awkward self.up and self.down method definitions.</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>Ruby - db/migrate/20110505101557_remove_title_from_post.rb</em>&#x000A;<div class="highlight"><pre>    <span class="k">class</span> <span class="nc">RemoveTitleFromPost</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>&#x000A;      <span class="k">def</span> <span class="nf">up</span>&#x000A;        <span class="n">remove_column</span> <span class="ss">:posts</span><span class="p">,</span> <span class="ss">:title</span>&#x000A;      <span class="k">end</span>&#x000A;&#x000A;      <span class="k">def</span> <span class="nf">down</span>&#x000A;        <span class="n">add_column</span> <span class="ss">:posts</span><span class="p">,</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">:string</span>&#x000A;      <span class="k">end</span>&#x000A;    <span class="k">end</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;<h3>More magic? :(</h3>&#x000A;&#x000A;<p>I guess a few people are wondering if ponies are carrying out the reversal of migrations. In the spirit of <a href="http://github.com/josevalim">Jose Valim</a>&#8217;s wish to see all Rails magic deconstructed I thought I&#8217;ll give a brief idea as to how Rails is reversing a migration automagically.</p>&#x000A;&#x000A;<p>The magic, erm I mean heavy lifting happens in the <a href="https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration/command_recorder.rb">ActiveRecord::Migration::CommandRecorder</a> class. Basically if you define a change method in your migration and are applying the migration then the commands are executed as normal.</p>&#x000A;&#x000A;<p>However while reversing the migration, the commands are recorded and a list of inverse commands is generated and run. Inverse commands are simply commands that perform the opposite of the original command. For eg: the inverse of rename_table(old, new) is rename_table(new, old). The logic to obtain an inverse of a command is provided in the class itself. For those commands whose inverse cannot be obtained, ActiveRecord::IrreversibleMigration is raised.</p>&#x000A;&#x000A;<p>That was a very simple overview of what is happening behind the scenes. I encourage you to take a look at the <a href="https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration/command_recorder.rb">code</a> for yourself to understand how it works.</p>&#x000A;  </div>&#x000A;  <div class="article">&#x000A;    <h2><a class="title" href="/articles/what-s-new-in-edge-rails/2011/04/21/activerecord-identity-map">ActiveRecord Identity Map</a></h2>&#x000A;    <div class="meta">&#x000A;      posted: April 21st, 2011&#x000A;    </div>&#x000A;    <p><span class="version"><strong>Rails</strong> 3.1</span></p>&#x000A;&#x000A;<p>If you&#8217;ve been using rails for a while now you may be familiar with Active Record&#8217;s query cache. The query cache is a powerful part of Active Record which reduces unnecessary SQL calls and provides general speed improvements, especially when dealing with associations. The problem with the query cache, however, is when retrieving two identical records from the database two in-memory objects will still be created.</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>rails console</em>&#x000A;<div class="highlight"><pre>  <span class="n">user1</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># =&gt; #&lt;User id: 1, name: &quot;Josh&quot;&gt;</span>&#x000A;  <span class="n">user2</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># =&gt; #&lt;User id: 1, name: &quot;Josh&quot;&gt;</span>&#x000A;&#x000A;  <span class="n">user1</span> <span class="o">==</span> <span class="n">user2</span> <span class="c1"># =&gt; true, b/c AR::Base recognizes that</span>&#x000A;                 <span class="c1"># they have the same primary key</span>&#x000A;&#x000A;  <span class="n">user1</span><span class="o">.</span><span class="n">object_id</span> <span class="o">==</span> <span class="n">user2</span><span class="o">.</span><span class="n">object_id</span> <span class="c1"># =&gt; false, b/c these are two</span>&#x000A;                                     <span class="c1"># different in-memory objects</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;&#x000A;&#x000A;<div class="code_window">&#x000A;<em>log/development.log</em>&#x000A;<div class="highlight"><pre>  <span class="k">User</span> <span class="k">Load</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">2</span><span class="n">ms</span><span class="p">)</span>  <span class="k">SELECT</span> <span class="ss">&quot;users&quot;</span><span class="p">.</span><span class="o">*</span> <span class="k">FROM</span> <span class="ss">&quot;users&quot;</span> <span class="k">WHERE</span> <span class="ss">&quot;users&quot;</span><span class="p">.</span><span class="ss">&quot;id&quot;</span> <span class="o">=</span> <span class="o">?</span> <span class="k">LIMIT</span> <span class="mi">1</span>  <span class="p">[[</span><span class="ss">&quot;id&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>&#x000A;  <span class="k">CACHE</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="n">ms</span><span class="p">)</span>  <span class="k">SELECT</span> <span class="ss">&quot;users&quot;</span><span class="p">.</span><span class="o">*</span> <span class="k">FROM</span> <span class="ss">&quot;users&quot;</span> <span class="k">WHERE</span> <span class="ss">&quot;users&quot;</span><span class="p">.</span><span class="ss">&quot;id&quot;</span> <span class="o">=</span> <span class="o">?</span> <span class="k">LIMIT</span> <span class="mi">1</span>  <span class="p">[[</span><span class="ss">&quot;id&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>Thanks to the fantastic work of <a href="http://twitter.com/miloops">Emilio Tagua</a> during the Ruby Summer of Code 2010, Active Record in 3.1 will gain an identity map. What&#8217;s an identity map you ask? An identity map keeps a collection of previously instantiated records and returns the object associated with the record if a request is made for it again.</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>rails console</em>&#x000A;<div class="highlight"><pre>  <span class="n">user1</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># =&gt; #&lt;User id: 1, name: &quot;Josh&quot;&gt;</span>&#x000A;  <span class="n">user2</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># =&gt; #&lt;User id: 1, name: &quot;Josh&quot;&gt;</span>&#x000A;&#x000A;  <span class="n">user1</span> <span class="o">==</span> <span class="n">user2</span> <span class="c1"># =&gt; true</span>&#x000A;&#x000A;  <span class="n">user1</span><span class="o">.</span><span class="n">object_id</span> <span class="o">==</span> <span class="n">user2</span><span class="o">.</span><span class="n">object_id</span> <span class="c1"># =&gt; true, b/c these really are</span>&#x000A;                                     <span class="c1"># the same in-memory objects</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;&#x000A;&#x000A;<div class="code_window">&#x000A;<em>log/development.log</em>&#x000A;<div class="highlight"><pre>  <span class="k">User</span> <span class="k">Load</span> <span class="p">(</span><span class="mi">2</span><span class="p">.</span><span class="mi">2</span><span class="n">ms</span><span class="p">)</span>  <span class="k">SELECT</span> <span class="ss">&quot;users&quot;</span><span class="p">.</span><span class="o">*</span> <span class="k">FROM</span> <span class="ss">&quot;users&quot;</span> <span class="k">LIMIT</span> <span class="mi">1</span>&#x000A;  <span class="k">User</span> <span class="k">with</span> <span class="n">ID</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">loaded</span> <span class="k">from</span> <span class="k">Identity</span> <span class="k">Map</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;&#x000A;&#x000A;<div class="notice">&#x000A;<p>&#x000A;Why is having the same in-memory object returned important? Because it&#x000A;ensures that there is only one copy of a model instance floating around&#x000A;your system at any one time. Without this assurance, modifications made to a model&#x000A;object in one context won&#8217;t be reflected if a copy exists in another&#x000A;context which can produce hard to trace bugs and inconsistencies.&#x000A;</p>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>The identity map is created on a per-request basis and is flushed at the completion of the request (as can be expected, the implementation is thread-safe). You can also use an identity map in the console, background worker, or manually within a request (if it&#8217;s turned off by default).</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>Ruby - app/models/user.rb</em>&#x000A;<div class="highlight"><pre>  <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">IdentityMap</span><span class="o">.</span><span class="n">use</span> <span class="k">do</span>&#x000A;    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>&#x000A;    <span class="n">user</span><span class="o">.</span><span class="n">do_that_heavy_thing_you_do!</span>&#x000A;  <span class="k">end</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>Although Rails 3.1 will come with the identity map built-in and turned on out of the box, you can try it out for yourself by living on the edge and changing the following in application.rb :</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>Ruby - config/application.rb</em>&#x000A;<div class="highlight"><pre>  <span class="n">config</span><span class="o">.</span><span class="n">active_record</span><span class="o">.</span><span class="n">identity_map</span> <span class="o">=</span> <span class="kp">true</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>And while the query cache is all about speed improvements, the identity map is primarily focused on consistency, thus they go hand in hand.</p>&#x000A;&#x000A;<div class="notice resources">&#x000A;  <p>The following resources were instrumental in the research, creation and construction of this article.  They may also provide a different angle should you be left wanting after reading this post:</p>&#x000A;&#x000A;  <ul>&#x000A;    <li><a href="http://miloops.com/post/3391477665/identity-map-and-active-record">Emilio Tagua&#8217;s blog post</a></li>&#x000A;    <li><a href="https://github.com/rails/rails/blob/master/activerecord/lib/active_record/identity_map.rb">Some of the Identity Map code</a></li>&#x000A;    <li><a href="https://github.com/rails/rails/pull/76">The original pull request</a></li>&#x000A;    <li><a href="http://www.martinfowler.com/eaaCatalog/identityMap.html">And the Identity Map pattern</a></li>&#x000A;  </ul>&#x000A;</div>&#x000A;&#x000A;  </div>&#x000A;  <div class="article">&#x000A;    <h2><a class="title" href="/articles/what-s-new-in-edge-rails/2011/03/09/custom-activerecord-attribute-serialization">Custom ActiveRecord Attribute Serialization</a></h2>&#x000A;    <div class="meta">&#x000A;      posted: March 9th, 2011&#x000A;    </div>&#x000A;    <p><span class="version"><strong>Rails</strong> 3.1</span></p>&#x000A;&#x000A;<p>As you might know already, ActiveRecord lets you store serialized objects by using <code>serialize</code> in your model:</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>Ruby - app/models/user.rb</em>&#x000A;<div class="highlight"><pre>  <span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>&#x000A;    <span class="n">serialize</span> <span class="ss">:interests</span>&#x000A;  <span class="k">end</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>These serializeable attributes can then be set as any Ruby type such as an array:</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>rails console</em>&#x000A;<div class="highlight"><pre><span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">create!</span><span class="p">(</span><span class="ss">:interests</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">&#39;dinosaurs&#39;</span><span class="p">,</span> <span class="s1">&#39;lasers&#39;</span><span class="o">]</span><span class="p">)</span>&#x000A;<span class="n">user</span><span class="o">.</span><span class="n">reload</span><span class="o">.</span><span class="n">interests</span> <span class="c1"># =&gt; [&quot;dinosaurs&quot;, &quot;lasers&quot;]</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>Under the hood, this array is automatically converted to YAML. You won&#8217;t notice this unless you check what&#8217;s being inserted into your database:</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>log/development.log</em>&#x000A;<div class="highlight"><pre><span class="k">INSERT</span> <span class="k">INTO</span> <span class="ss">&quot;users&quot;</span> <span class="p">(</span><span class="ss">&quot;updated_at&quot;</span><span class="p">,</span> <span class="ss">&quot;interests&quot;</span><span class="p">,</span> <span class="ss">&quot;created_at&quot;</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;2011-03-05 13:14:05.054192&#39;</span><span class="p">,</span> <span class="s1">&#39;---</span>&#x000A;<span class="s1">- dinosaurs</span>&#x000A;<span class="s1">- lasers</span>&#x000A;<span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-03-05 13:14:05.054192&#39;</span><span class="p">)</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;<h3>Using arbitrary objects</h3>&#x000A;&#x000A;<p>Aaron Patterson recently did some work for Rails 3.1 which allows you to use arbitrary objects to serialize your attributes, all they need to do is respond to <code>load</code> and <code>dump</code>. This allows you to specify a custom encoding for your models <code>serialize</code> fields. For example, here is what a Base64 encoding might look like:</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>Ruby - app/models/user.rb</em>&#x000A;<div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>&#x000A;  <span class="k">class</span> <span class="nc">Base64</span>&#x000A;    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>&#x000A;      <span class="k">return</span> <span class="k">unless</span> <span class="n">text</span>&#x000A;      <span class="n">text</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>&#x000A;    <span class="k">end</span>&#x000A;&#x000A;    <span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>&#x000A;      <span class="o">[</span><span class="n">text</span><span class="o">].</span><span class="n">pack</span> <span class="s1">&#39;m&#39;</span>&#x000A;    <span class="k">end</span>&#x000A;  <span class="k">end</span>&#x000A;&#x000A;  <span class="n">serialize</span> <span class="ss">:bank_account_number</span><span class="p">,</span> <span class="no">Base64</span><span class="o">.</span><span class="n">new</span>&#x000A;<span class="k">end</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>Just like the default YAML serialization, ActiveRecord won&#8217;t bother you with any serialized data, unless you check the SQL query:</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>rails console</em>&#x000A;<div class="highlight"><pre><span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">create!</span><span class="p">(</span><span class="ss">:bank_account_number</span> <span class="o">=&gt;</span> <span class="s2">&quot;0000001 00000011 0000001 00000011&quot;</span><span class="p">)</span>&#x000A;<span class="n">user</span><span class="o">.</span><span class="n">reload</span>&#x000A;<span class="n">user</span><span class="o">.</span><span class="n">bank_account_number</span> <span class="c1"># =&gt; &quot;0000001 00000011 0000001 00000011&quot;</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;&#x000A;&#x000A;<div class="code_window">&#x000A;<em>log/development.log</em>&#x000A;<div class="highlight"><pre><span class="k">INSERT</span> <span class="k">INTO</span> <span class="ss">&quot;users&quot;</span> <span class="p">(</span><span class="ss">&quot;updated_at&quot;</span><span class="p">,</span> <span class="ss">&quot;bank_account_number&quot;</span><span class="p">,</span> <span class="ss">&quot;created_at&quot;</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;2011-03-05 17:12:01.459862&#39;</span><span class="p">,</span> <span class="s1">&#39;MDAwMDAwMSAwMDAwMDAxMSAwMDAwMDAxIDAwMDAwMDEx\n&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-03-05 17:12:01.459862&#39;</span><span class="p">)</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>Just remember, YAML serialization is still used by default, but creating your own serialization object is as simple as <code>load</code> and <code>dump</code>.</p>&#x000A;&#x000A;<h4>Links:</h4>&#x000A;&#x000A;<p><a href="http://www.youtube.com/watch?v=7cco1jxori8">Custom serialization in action video</a></p>&#x000A;&#x000A;<p>The Rails commits <a href="https://github.com/rails/rails/commit/3cc2b77dc1cb4c1e5cfac68c7828e35a27415e0d">here</a> and <a href="https://github.com/rails/rails/commit/ebe485fd8ec80a1a9b86516bc6f74bc5bbba3476">here</a></p>&#x000A;  </div>&#x000A;  <div class="article">&#x000A;    <h2><a class="title" href="/articles/what-s-new-in-edge-rails/2011/01/12/template-inheritance">Template Inheritance</a></h2>&#x000A;    <div class="meta">&#x000A;      posted: January 12th, 2011&#x000A;    </div>&#x000A;    <p><span class="version"><strong>Rails</strong> 3.1</span></p>&#x000A;&#x000A;<p>Now that the internals of Rails 3 are a little more hospitable to changes we now have a <a href="https://rails.lighthouseapp.com/projects/8994/tickets/948">long-standing feature request</a> finally implemented - <a href="https://github.com/rails/rails/commit/0f32febad7bca595df44">inherited templates</a>. As the name implies, inherited templates make template lookup follow the controller inheritance heirarchy if it can&#8217;t find a template for the current controller. This is probably best described with a basic code example. Assuming we have the following controller heirarchy (basically PostsController inherits from AssetsController):</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>Ruby - assets_controller.rb</em>&#x000A;<div class="highlight"><pre><span class="k">class</span> <span class="nc">AssetsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>&#x000A;  <span class="c1"># Assume index, show etc... action definitions</span>&#x000A;<span class="k">end</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;&#x000A;&#x000A;<div class="code_window">&#x000A;<em>Ruby - posts_controller.rb</em>&#x000A;<div class="highlight"><pre><span class="k">class</span> <span class="nc">PostsController</span> <span class="o">&lt;</span> <span class="no">AssetsController</span>&#x000A;  <span class="c1"># Assume index, show etc... action definitions</span>&#x000A;<span class="k">end</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>Assume there are asset templates for <code>show</code> and <code>index</code> but only an <code>index</code> template for posts:</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>Bash - directory listings</em>&#x000A;<div class="highlight"><pre>myapp &gt; ls app/views/assets&#x000A;index.html.haml     show.html.haml&#x000A;&#x000A;myapp &gt; ls app/views/posts&#x000A;index.html.haml&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>In this scenario any request to the <code>show</code> action of the <code>posts_controller</code> will be rendered using the <code>views/assets/show</code> template. <code>index</code> requests will be rendered as expected since both controllers have their own index templates.</p>&#x000A;&#x000A;<p><span class="notice">&#x000A;Template inheritance also applies to partial lookups and does not touch layout lookup which is already based on heirarchical lookup. (So basically all template types have inherited lookups.)&#x000A;</span></p>&#x000A;&#x000A;<p>While a seemingly small feature this new inherited lookup of templates allows you to reuse whole parts of common view logic without resorting to using an amalgamation of partials to accomplish the same thing.</p>&#x000A;  </div>&#x000A;  <div class="article">&#x000A;    <h2><a class="title" href="/articles/what-s-new-in-edge-rails/2010/02/23/the-skinny-on-scopes-formerly-named-scope">The Skinny on Scopes (Formerly named_scope)</a></h2>&#x000A;    <div class="meta">&#x000A;      posted: February 23rd, 2010&#x000A;    </div>&#x000A;    <p><span class="version"><strong>Rails</strong> 3.0</span></p>&#x000A;&#x000A;<p><span class="notice source">&#x000A;  The source for the examples contained in this article are located at: <a href="http://github.com/rwdaigle/edgerails-support/tree/master/the-skinny-on-scopes-formerly-named-scope/">http://github.com/rwdaigle/edgerails-support/tree/master/the-skinny-on-scopes-formerly-named-scope/</a>&#x000A;</span></p>&#x000A;&#x000A;<p>I remember my heart fluttering with a boyish crush the first time I saw <a href="http://magicscalingsprinkles.wordpress.com/">Nick Kallen</a>&#8217;s has_finder functionality <a href="/articles/what-s-new-in-edge-rails/2008/03/24/what-s-new-in-edge-rails-has-finder-functionality/">make it into Rails in the form of <code>named_scope</code></a>. <code>named_scope</code> quickly made its way into my toolset as a great way to encapsulate reusable, chainable bits of query logic.  While it had its downsides (namely its lack of first-class chain support for the likes of <code>:joins</code> and <code>:include</code>) it redefined how I thought about structuring my model logic.  Once you taste the chainable goodness of <code>named_scope</code> you never go back.</p>&#x000A;&#x000A;<p>So here we are with Rails 3 completely refactoring the internals of ActiveRecord - what&#8217;s up with our beloved <code>named_scope</code>?  Well, the simple answer is that it&#8217;s been renamed to <code>scope</code> and you can use it just as you&#8217;re used to &#8230; but that&#8217;s taking the easy way out.  Let&#8217;s see what else we can do with <code>scope</code> in Rails 3.</p>&#x000A;&#x000A;<h3>Basic Usage</h3>&#x000A;&#x000A;<p>Let&#8217;s assume a standard <code>Post</code> model with <code>published_at</code> datetime field along with <code>title</code> and <code>body</code> (to follow along in code, see the <a href="http://github.com/rwdaigle/edgerails-support/tree/master/20100221_skinny_on_scopes/">accompanying project in github</a>).</p>&#x000A;&#x000A;<p>In Rails 2.x here&#8217;s how we&#8217;d have to define the self-explanatory <code>published</code> and <code>recent</code> named scopes:</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>Ruby - post.rb</em>&#x000A;<div class="highlight"><pre><span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>&#x000A;&#x000A;  <span class="n">named_scope</span> <span class="ss">:published</span><span class="p">,</span> <span class="nb">lambda</span> <span class="p">{</span> &#x000A;    <span class="p">{</span> <span class="ss">:conditions</span> <span class="o">=&gt;</span>&#x000A;      <span class="o">[</span><span class="s2">&quot;posts.published_at IS NOT NULL AND posts.published_at &lt;= ?&quot;</span><span class="p">,</span> <span class="no">Time</span><span class="o">.</span><span class="n">zone</span><span class="o">.</span><span class="n">now</span><span class="o">]</span>&#x000A;    <span class="p">}</span>&#x000A;  <span class="p">}</span>  &#x000A;  <span class="n">named_scope</span> <span class="ss">:recent</span><span class="p">,</span> <span class="ss">:order</span> <span class="o">=&gt;</span> <span class="s2">&quot;posts.published_at DESC&quot;</span>&#x000A;<span class="k">end</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p><span class="notice">&#x000A;  The reason we need to use a <code>lambda</code> here is that it delays the evaluation of the <code>Time.zone.now</code> argument to when the scope is actually invoked.  Without the <code>lambda</code> the time that would be used in the query logic would be the time that the class was first evaluated, not the scope itself.&#x000A;</span></p>&#x000A;&#x000A;<p>With Rails 3 the bulk of ActiveRecord is now based on the <a href="http://github.com/rails/rails/blob/master/activerecord/lib/active_record/relation.rb">Relation</a> class.  Think of relation as named_scope on steroids, weaving chainable query logic into the very fabric of ActiveRecord.</p>&#x000A;&#x000A;<p>You can see how to use the individual <code>where</code>, <code>order</code> etc&#8230; commands of <code>Relation</code> on <a href="http://m.onkey.org/2010/1/22/active-record-query-interface">Pratik&#8217;s great writeup of the new query interface</a> as well in <a href="http://railscasts.com/episodes/202-active-record-queries-in-rails-3">this Railscast</a>.  Understanding these are important as the new <code>scope</code> is built upon them.</p>&#x000A;&#x000A;<p>Let&#8217;s see how - here&#8217;s how the two named scopes from our previous <code>Post</code> example will look in Rails 3:</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>Ruby - post.rb</em>&#x000A;<div class="highlight"><pre><span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>&#x000A;&#x000A;  <span class="n">scope</span> <span class="ss">:published</span><span class="p">,</span> <span class="nb">lambda</span> <span class="p">{</span> &#x000A;    <span class="n">where</span><span class="p">(</span><span class="s2">&quot;posts.published_at IS NOT NULL AND posts.published_at &lt;= ?&quot;</span><span class="p">,</span> <span class="no">Time</span><span class="o">.</span><span class="n">zone</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>&#x000A;  <span class="p">}</span>  &#x000A;  <span class="n">scope</span> <span class="ss">:recent</span><span class="p">,</span> <span class="n">order</span><span class="p">(</span><span class="s2">&quot;posts.published_at DESC&quot;</span><span class="p">)</span>&#x000A;<span class="k">end</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>While the bulk of the logic is the same - the SQL string portions - you start to see how scopes use the new query interface directly to create reusable query logic versus constructing an options hash as was done in Rails 2.  This really is our first glimpse of how much more flexible the new query interface allows our scopes to be.  No longer are they a slightly different construct than your normal query methods.  They are now <em>built upon</em> the very same query methods that you would use were you to execute a query directly.  This consistency is now prevalent all throughout ActiveRecord.</p>&#x000A;&#x000A;<p>And there&#8217;s more&#8230;</p>&#x000A;&#x000A;<h3>Scope Reusability</h3>&#x000A;&#x000A;<p>Suppose we want to update our <code>recent</code> scope to only include published posts.  We&#8217;ve already defined what <code>published</code> means and shouldn&#8217;t have to redefine it to create a new scope.  Well, you can also chain scopes within scope definitions themselves as we&#8217;ll do here with the new <code>recent</code> and <code>published_since</code> scopes.</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>Ruby - post.rb</em>&#x000A;<div class="highlight"><pre><span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>&#x000A;  &#x000A;  <span class="n">scope</span> <span class="ss">:published</span><span class="p">,</span> <span class="nb">lambda</span> <span class="p">{</span> &#x000A;    <span class="n">where</span><span class="p">(</span><span class="s2">&quot;posts.published_at IS NOT NULL AND posts.published_at &lt;= ?&quot;</span><span class="p">,</span> <span class="no">Time</span><span class="o">.</span><span class="n">zone</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>&#x000A;  <span class="p">}</span>&#x000A;  <span class="n">scope</span> <span class="ss">:published_since</span><span class="p">,</span> <span class="nb">lambda</span> <span class="p">{</span> <span class="o">|</span><span class="n">ago</span><span class="o">|</span>&#x000A;    <span class="n">published</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;posts.published_at &gt;= ?&quot;</span><span class="p">,</span> <span class="n">ago</span><span class="p">)</span>&#x000A;  <span class="p">}</span>&#x000A;  &#x000A;  <span class="n">scope</span> <span class="ss">:recent</span><span class="p">,</span> <span class="n">published</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="s2">&quot;posts.published_at DESC&quot;</span><span class="p">)</span>&#x000A;<span class="k">end</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>Ok, now we&#8217;re getting warmed up.</p>&#x000A;&#x000A;<h3>Dynamic Scope Construction</h3>&#x000A;&#x000A;<p>I&#8217;ve been in love with the <a href="http://github.com/rails/rails/blob/17f336e2f00f419a41eb7effb817bd7ad3e84f0d/activerecord/lib/active_record/named_scope.rb#L3"><code>scoped</code> the anonymous named_scope constructor</a> in Rails 2.3 for sometime now, using it to create dynamic and chainable scopes on an as-needed basis.  One use-case you see a lot for this type of functionality is for creating a <code>search</code> method that you can still append other query manipulations onto.</p>&#x000A;&#x000A;<p>For instance, to search our posts we can create this method which will return a scope for your caller to further filter (notice the use of <code>scoped</code> to start the chain off with an innocuous scope upon which others can be appended):</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>Ruby - post.rb</em>&#x000A;<div class="highlight"><pre><span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>&#x000A;  &#x000A;  <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>&#x000A;    &#x000A;    <span class="c1"># Search the title and body fields for the given string.</span>&#x000A;    <span class="c1"># Start with an empty scope and build on it for each attr.</span>&#x000A;    <span class="c1"># (Allows for easy extraction of searchable fields definition</span>&#x000A;    <span class="c1"># in the future)</span>&#x000A;    <span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>&#x000A;      <span class="o">[</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:body</span><span class="o">].</span><span class="n">inject</span><span class="p">(</span><span class="n">scoped</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">combined_scope</span><span class="p">,</span> <span class="kp">attr</span><span class="o">|</span>&#x000A;        <span class="n">combined_scope</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;posts.</span><span class="si">#{</span><span class="kp">attr</span><span class="si">}</span><span class="s2"> LIKE ?&quot;</span><span class="p">,</span> <span class="s2">&quot;%</span><span class="si">#{</span><span class="n">q</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>&#x000A;      <span class="k">end</span>&#x000A;    <span class="k">end</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>The use of <code>inject</code> here somewhat obfuscates the intent of the method if you&#8217;re not used to looking at such iterations - here&#8217;s an easier to follow version with the searchable fields more hard coded (which actually doesn&#8217;t even use an anonymous scope to get bootstrapped):</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>Ruby - post.rb</em>&#x000A;<div class="highlight"><pre><span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>&#x000A;  &#x000A;  <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>&#x000A;    &#x000A;    <span class="c1"># The less-slick but, perhaps, more obvious version</span>&#x000A;    <span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>&#x000A;      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;%</span><span class="si">#{</span><span class="n">q</span><span class="si">}</span><span class="s2">%&quot;</span>&#x000A;      <span class="n">where</span><span class="p">(</span><span class="s2">&quot;posts.title LIKE ?&quot;</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;posts.body LIKE ?&quot;</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>&#x000A;    <span class="k">end</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>Since we&#8217;re building upon the chainable goodness of then new query interface (think of scopes now as named bundles of the new ActiveRelation construct), we can do the following with the <code>search</code> method:</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>Ruby - irb session</em>&#x000A;<div class="highlight"><pre><span class="c1"># What&#39;s in the db, titles ~= publish date</span>&#x000A;<span class="no">Post</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:title</span><span class="p">)</span> <span class="c1">#=&gt; [&quot;1 week from now&quot;, &quot;Now&quot;, &quot;1 week ago&quot;, &quot;2 weeks ago&quot;]</span>&#x000A;<span class="no">Post</span><span class="o">.</span><span class="n">published</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:title</span><span class="p">)</span> <span class="c1">#=&gt; [&quot;Now&quot;, &quot;1 week ago&quot;, &quot;2 weeks ago&quot;]</span>&#x000A;&#x000A;<span class="c1"># Search combinations</span>&#x000A;<span class="no">Post</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:title</span><span class="p">)</span> <span class="c1">#=&gt; [&quot;1 week from now&quot;, &quot;1 week ago&quot;]</span>&#x000A;<span class="no">Post</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">published</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:title</span><span class="p">)</span> <span class="c1">#=&gt; [&quot;1 week ago&quot;]</span>&#x000A;<span class="no">Post</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">published_since</span><span class="p">(</span><span class="mi">10</span><span class="o">.</span><span class="n">days</span><span class="o">.</span><span class="n">ago</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:title</span><span class="p">)</span> <span class="c1">#=&gt; [&quot;Now&quot;, &quot;1 week ago&quot;]</span>&#x000A;<span class="no">Post</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="s1">&#39;created_at DESC&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:title</span><span class="p">)</span> <span class="c1">#=&gt; [&quot;2 weeks ago&quot;, &quot;1 week ago&quot;]</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>You can imagine a scenario where more complex query-string support could be built, all using anonymous scopes.</p>&#x000A;&#x000A;<p>Feels great, huh?  It also feels a lot like the <a href="http://rubygems.org/gems/utility_scopes"><code>utility_scopes</code> gem</a> I <a href="http://ryandaigle.com/articles/2008/8/20/named-scope-it-s-not-just-for-conditions-ya-know">released awhile ago</a> which was my attempt to package up the chainable goodness of named_scope for common query operations.  Rest-assured, there&#8217;s a much smoother implementation under the covers here in Rails 3 than just some hacks on top of <code>named_scope</code></p>&#x000A;&#x000A;<h3>Cross-Model Scopes</h3>&#x000A;&#x000A;<p>Scopes are great for operating solely on the columns of a singular class&#8217;s table, but they can also be used to package cross-model queries (i.e. any SQL that would require a <code>join</code>).  Let&#8217;s add in users (who can author and comment on posts) to the mix and write some scopes on <code>User</code> that will fetch only users that have authored published posts as well as users that have commented on a post:</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>Ruby - user.rb</em>&#x000A;<div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>&#x000A;&#x000A;  <span class="n">has_many</span> <span class="ss">:posts</span><span class="p">,</span> <span class="ss">:foreign_key</span> <span class="o">=&gt;</span> <span class="ss">:author_id</span>&#x000A;  <span class="n">has_many</span> <span class="ss">:comments</span>&#x000A;  &#x000A;  <span class="c1"># Get all users that have published a post</span>&#x000A;  <span class="n">scope</span> <span class="ss">:published</span><span class="p">,</span> <span class="nb">lambda</span> <span class="p">{</span>&#x000A;    <span class="n">joins</span><span class="p">(</span><span class="s2">&quot;join posts on posts.author_id = users.id&quot;</span><span class="p">)</span><span class="o">.</span>&#x000A;    <span class="n">where</span><span class="p">(</span><span class="s2">&quot;posts.published_at IS NOT NULL AND posts.published_at &lt;= ?&quot;</span><span class="p">,</span> <span class="no">Time</span><span class="o">.</span><span class="n">zone</span><span class="o">.</span><span class="n">now</span><span class="p">)</span><span class="o">.</span>&#x000A;    <span class="n">group</span><span class="p">(</span><span class="s2">&quot;users.id&quot;</span><span class="p">)</span>&#x000A;  <span class="p">}</span>&#x000A;  &#x000A;  <span class="c1"># Get all users that have commented on a post</span>&#x000A;  <span class="n">scope</span> <span class="ss">:commented</span><span class="p">,</span> <span class="n">joins</span><span class="p">(</span><span class="s2">&quot;join comments on comments.user_id = users.id&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;users.id&quot;</span><span class="p">)</span>&#x000A;<span class="k">end</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>Also, as <a href="/articles/what-s-new-in-edge-rails/2010/02/23/the-skinny-on-scopes-formerly-named-scope/#comment-36265313">Steffen pointed out in the comments</a>, ActiveRelation is smart enough to know how to do a join based on an association definition, allowing us to collapse the joins relations from SQL strings to an association reference:</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>Ruby - user.rb</em>&#x000A;<div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>&#x000A;  &#x000A;  <span class="c1"># Get all users that have published a post</span>&#x000A;  <span class="n">scope</span> <span class="ss">:published</span><span class="p">,</span> <span class="nb">lambda</span> <span class="p">{</span>&#x000A;    <span class="n">joins</span><span class="p">(</span><span class="ss">:posts</span><span class="p">)</span><span class="o">.</span>              <span class="c1"># No need to write your own SQL</span>&#x000A;    <span class="n">where</span><span class="p">(</span><span class="s2">&quot;posts.published_at IS NOT NULL AND posts.published_at &lt;= ?&quot;</span><span class="p">,</span> <span class="no">Time</span><span class="o">.</span><span class="n">zone</span><span class="o">.</span><span class="n">now</span><span class="p">)</span><span class="o">.</span>&#x000A;    <span class="n">group</span><span class="p">(</span><span class="s2">&quot;users.id&quot;</span><span class="p">)</span>&#x000A;  <span class="p">}</span>&#x000A;  &#x000A;  <span class="c1"># Get all users that have commented on a post</span>&#x000A;  <span class="n">scope</span> <span class="ss">:commented</span><span class="p">,</span> <span class="n">joins</span><span class="p">(</span><span class="ss">:comments</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;users.id&quot;</span><span class="p">)</span> <span class="c1"># Just reference :comments</span>&#x000A;<span class="k">end</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;&#x000A;&#x000A;<div class="notice">&#x000A;  <p>It&#8217;s a good practice to always refer to the full <code>table_name.column_name</code> when building scopes versus just the <code>column_name</code> itself (i.e.: <code>posts.published_at</code> vs. just <code>published_at</code> in the example above).  This allows for unambiguous column references - especially important when building cross-model scopes where columns from more than one table are joined.</p>&#x000A;&#x000A;  <p>To be extra-flexible you can always invoke <code>table_name</code> in place of the hard-coded table name, though. to confess, this is a step I rarely take the time to implement myself: <code>where("#{table_name}.published_at IS NOT NULL")</code></p>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>Since we&#8217;ve got the full arsenal of ActiveRelation operators at our disposal in scopes, we can do joins and group bys within scopes that will be safely chained in complex queries - something where the old <code>named_scope</code> crapped the bed:</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>Ruby - irb session</em>&#x000A;<div class="highlight"><pre><span class="c1"># Get all users that have a post published</span>&#x000A;<span class="no">User</span><span class="o">.</span><span class="n">published</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:username</span><span class="p">)</span> <span class="c1">#=&gt; [&quot;tim&quot;, &quot;dave&quot;]</span>&#x000A;<span class="no">User</span><span class="o">.</span><span class="n">published</span><span class="o">.</span><span class="n">to_sql</span>&#x000A;  <span class="c1">#=&gt; SELECT &quot;users&quot;.* FROM &quot;users&quot; join posts on posts.author_id = users.id</span>&#x000A;  <span class="c1">#   WHERE (posts.published_at IS NOT NULL AND posts.published_at &lt;= &#39;2010-02-22 21:33:00.892308&#39;)</span>&#x000A;  <span class="c1">#   GROUP BY users.id</span>&#x000A;  &#x000A;<span class="c1"># Get all users that have commented on a post</span>&#x000A;<span class="no">User</span><span class="o">.</span><span class="n">commented</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:username</span><span class="p">)</span> <span class="c1">#=&gt; [&quot;ryan&quot;, &quot;john&quot;, &quot;tim&quot;, &quot;dave&quot;]</span>&#x000A;<span class="no">User</span><span class="o">.</span><span class="n">commented</span><span class="o">.</span><span class="n">to_sql</span>&#x000A;  <span class="c1">#=&gt; SELECT &quot;users&quot;.* FROM &quot;users&quot; join comments on comments.user_id = users.id</span>&#x000A;  <span class="c1">#   GROUP BY users.id</span>&#x000A;  &#x000A;<span class="c1"># Combine them to get all authors that have also commented</span>&#x000A;<span class="no">User</span><span class="o">.</span><span class="n">published</span><span class="o">.</span><span class="n">commented</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:username</span><span class="p">)</span> <span class="c1">#=&gt; [&quot;tim&quot;, &quot;dave&quot;]</span>&#x000A;<span class="no">User</span><span class="o">.</span><span class="n">published</span><span class="o">.</span><span class="n">commented</span><span class="o">.</span><span class="n">to_sql</span>&#x000A;  <span class="c1">#=&gt; SELECT &quot;users&quot;.* FROM &quot;users&quot;</span>&#x000A;  <span class="c1">#   join posts on posts.author_id = users.id</span>&#x000A;  <span class="c1">#   join comments on comments.user_id = users.id</span>&#x000A;  <span class="c1">#   WHERE (posts.published_at IS NOT NULL AND posts.published_at &lt;= &#39;2010-02-22 21:33:00.892308&#39;)</span>&#x000A;  <span class="c1">#   GROUP BY users.id</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p><span class="notice">&#x000A;  As I&#8217;ve done here, use <code>scope#to_sql</code> to peek at what SQL the scope will execute.  Very useful for debugging purposes.&#x000A;</span></p>&#x000A;&#x000A;<h3>Scope-based Model CRUD</h3>&#x000A;&#x000A;<p>Since ActiveRelation lets you invoke all the builder/update/destroy methods on a relation that you&#8217;re used to using directly against your models, that power is also available at the end of a scope/scope-chain.  Let&#8217;s play around with our post scopes and use them to do more than just query:</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>Ruby - irb session</em>&#x000A;<div class="highlight"><pre><span class="c1"># Increment the views_count for all published posts</span>&#x000A;<span class="no">Post</span><span class="o">.</span><span class="n">published</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:views_count</span><span class="p">)</span> <span class="c1">#=&gt; [59, 71, 42]</span>&#x000A;<span class="no">Post</span><span class="o">.</span><span class="n">published</span><span class="o">.</span><span class="n">update_all</span><span class="p">(</span><span class="s2">&quot;views_count = views_count + 1&quot;</span><span class="p">)</span>&#x000A;<span class="no">Post</span><span class="o">.</span><span class="n">published</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:views_count</span><span class="p">)</span> <span class="c1">#=&gt; [60, 72, 43]</span>&#x000A;&#x000A;<span class="c1"># Nobody cares about unpublished posts</span>&#x000A;<span class="no">Post</span><span class="o">.</span><span class="n">unpublished</span><span class="o">.</span><span class="n">size</span> <span class="c1">#=&gt; 1</span>&#x000A;<span class="no">Post</span><span class="o">.</span><span class="n">unpublished</span><span class="o">.</span><span class="n">destroy_all</span>&#x000A;<span class="no">Post</span><span class="o">.</span><span class="n">unpublished</span><span class="o">.</span><span class="n">size</span> <span class="c1">#=&gt; 0</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>You can also create a new model from existing scopes - suppose we have a (very contrived) scoped that gets only posts of certain title:</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>Ruby - post.rb</em>&#x000A;<div class="highlight"><pre><span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>&#x000A;  &#x000A;  <span class="c1"># Ludacris</span>&#x000A;  <span class="n">scope</span> <span class="ss">:titled_luda</span><span class="p">,</span> <span class="n">where</span><span class="p">(</span><span class="ss">:title</span> <span class="o">=&gt;</span> <span class="s1">&#39;Luda&#39;</span><span class="p">)</span>&#x000A;<span class="k">end</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>We can use this scope to directly build instances (as well as create, new, create! etc&#8230;):</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>Ruby - irb session</em>&#x000A;<div class="highlight"><pre><span class="no">Post</span><span class="o">.</span><span class="n">titled_luda</span><span class="o">.</span><span class="n">size</span> <span class="c1">#=&gt; 0</span>&#x000A;<span class="no">Post</span><span class="o">.</span><span class="n">titled_luda</span><span class="o">.</span><span class="n">build</span>&#x000A;  <span class="c1">#=&gt; #&lt;Post id: nil, title: &quot;Luda&quot;, ...&gt;</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;&#x000A;&#x000A;<div class="notice alert">&#x000A;  <p>In order to use the creation/builder methods on a scope, the scope should directly define attribute equality using a `where` relation and the hash form of the attribute values, as was done above.</p>&#x000A;  &#x000A;  <p>Specifying <code>where("title = 'Luda'")</code> would not have propagated the attribute values to newly constructed instances.</p>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>Scopes really can be thought of now as named packages of <em>both</em> query and construction logic.  Very powerful.</p>&#x000A;&#x000A;<p><a name="crazytown"></a></p>&#x000A;&#x000A;<h3>Crazy Town</h3>&#x000A;&#x000A;<p>One thing that&#8217;s always bugged me is how the logic for what makes a <code>Post</code> published is split between scopes in both the <code>Post</code> class and the <code>User</code> class.  To refresh our collective memories:</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>Ruby - post.rb</em>&#x000A;<div class="highlight"><pre><span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>&#x000A;  &#x000A;  <span class="n">scope</span> <span class="ss">:published</span><span class="p">,</span> <span class="nb">lambda</span> <span class="p">{</span> &#x000A;    <span class="n">where</span><span class="p">(</span><span class="s2">&quot;posts.published_at IS NOT NULL AND posts.published_at &lt;= ?&quot;</span><span class="p">,</span> <span class="no">Time</span><span class="o">.</span><span class="n">zone</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>&#x000A;  <span class="p">}</span>&#x000A;<span class="k">end</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>And:</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>Ruby - user.rb</em>&#x000A;<div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>&#x000A;  &#x000A;  <span class="n">scope</span> <span class="ss">:published</span><span class="p">,</span> <span class="nb">lambda</span> <span class="p">{</span>&#x000A;    <span class="n">joins</span><span class="p">(</span><span class="ss">:posts</span><span class="p">)</span><span class="o">.</span>&#x000A;    <span class="n">where</span><span class="p">(</span><span class="s2">&quot;posts.published_at IS NOT NULL AND posts.published_at &lt;= ?&quot;</span><span class="p">,</span> <span class="no">Time</span><span class="o">.</span><span class="n">zone</span><span class="o">.</span><span class="n">now</span><span class="p">)</span><span class="o">.</span>&#x000A;    <span class="n">group</span><span class="p">(</span><span class="s2">&quot;users.id&quot;</span><span class="p">)</span>&#x000A;  <span class="p">}</span>&#x000A;<span class="k">end</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>Most good developers will immediately cringe at the duplication of the <code>where("posts.published_at IS NOT NULL AND posts.published_at &lt;= ?", Time.zone.now)</code> relation.</p>&#x000A;&#x000A;<p>Thanks to a <a href="http://disq.us/d0y5l">tip by Railscast&#8217;s Ryan Bates</a>, there&#8217;s a pretty slick way to refer to, and combine, scope logic: the <a href="http://github.com/rails/rails/blob/24cc9e5b4f9b729f02d2e0b56265032d08933a41/activerecord/lib/active_record/relation/spawn_methods.rb#L7">merge method, aliased as &#8216;&amp;&#8217;</a>. Let&#8217;s look at how we can use <code>scope#&amp;</code> to refer to the query logic of the <code>Post.published</code> scope from within our <code>User.published</code> scope:</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>Ruby - user.rb</em>&#x000A;<div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>&#x000A;  &#x000A;  <span class="n">scope</span> <span class="ss">:published</span><span class="p">,</span> <span class="nb">lambda</span> <span class="p">{</span>&#x000A;    <span class="n">joins</span><span class="p">(</span><span class="ss">:posts</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;users.id&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="no">Post</span><span class="o">.</span><span class="n">published</span>&#x000A;  <span class="p">}</span>&#x000A;<span class="k">end</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>Just so we&#8217;re clear what happens when you merge relations/scopes with the <code>&amp;</code> operator, let&#8217;s look at the resulting SQL:</p>&#x000A;&#x000A;<div class="code_window">&#x000A;<em>Ruby - irb session</em>&#x000A;<div class="highlight"><pre><span class="no">User</span><span class="o">.</span><span class="n">published</span><span class="o">.</span><span class="n">to_sql</span>&#x000A;  <span class="c1">#=&gt; SELECT users.* FROM &quot;users&quot;</span>&#x000A;  <span class="c1">#   INNER JOIN &quot;posts&quot; ON &quot;posts&quot;.&quot;author_id&quot; = &quot;users&quot;.&quot;id&quot;</span>&#x000A;  <span class="c1">#   WHERE (posts.published_at IS NOT NULL AND posts.published_at &lt;= &#39;2010-02-27 02:55:45.063181&#39;)</span>&#x000A;  <span class="c1">#   GROUP BY users.id</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>Notice how the conditions defined within <code>Post.published</code> are merged into the <code>joins</code> and <code>group</code> relations of the <code>User.published</code> scope?  Very nice. And merging works with all the mergeable relations, not just <code>where</code> conditions we used here.</p>&#x000A;&#x000A;<h3>Summary</h3>&#x000A;&#x000A;<p>This post somewhat glosses over the new query interface for ActiveRecord in Rails 3 to get to the meat of using scopes.  However, none of the scoped yumminess could have happened without the slick new underpinnings of ActiveRecord.  So, if you&#8217;re still a little confused about all this, definitely read some more about ActiveRecord before jumping into scopes.  Once you do have that foundation, however, you will use scopes on a very regular basis.</p>&#x000A;&#x000A;<div class="notice resources">&#x000A;  <p>The following resources were instrumental in the research, creation and construction of this article.  They may also provide a different angle should you be left wanting after reading this post:</p>&#x000A;&#x000A;  <ul>&#x000A;    <li><a href="http://m.onkey.org/2010/1/22/active-record-query-interface">Pratik&#8217;s &#8216;Active Record Query Interface 3.0&#8217; article</a></li>&#x000A;    <li><a href="http://railscasts.com/episodes/202-active-record-queries-in-rails-3">Railscast 202: Active Record Queries in Rails 3</a></li>&#x000A;  </ul>&#x000A;</div>&#x000A;&#x000A;  </div>&#x000A;  <div class="article">&#x000A;    <h2><a class="title" href="/articles/what-s-new-in-edge-rails/2010/02/18/notes-from-the-first-rails-online-conference">Notes From The First Rails Online Conference</a></h2>&#x000A;    <div class="meta">&#x000A;      posted: February 18th, 2010&#x000A;    </div>&#x000A;    <p><span class="version"><strong>Rails</strong> 3.0</span></p>&#x000A;&#x000A;<p>Earlier today the inaugural <a href="http://en.oreilly.com/railswinter10">Rails Online Conf</a> occurred and, Webex being a bag of hurt aside, it was a great experience.  Basically, we got a high-level rundown of most of the big changes (internal and external) in Rails 3 from an all-star lineup of Railstuds.  The slides are up on the site but if you want to save a single click-through, here they are again:</p>&#x000A;&#x000A;<ul>&#x000A;<li><a href="http://assets.en.oreilly.com/1/event/46/Getting%20up-to-date%20with%20Rails%203%20Presentation.pdf">Yehuda gives us the Rails 3 overview</a></li>&#x000A;<li><a href="http://assets.en.oreilly.com/1/event/46/Rails%202%20to%20the%203%20_Abridged_%20Presentation.pdf">Gregg Pollack bats second with a spirited highlight reel of Rails 3 goodies</a></li>&#x000A;<li><a href="http://assets.en.oreilly.com/1/event/46/Why%20Port_%20Presentation.pdf">Jeremy McAnally gives us the lowdown on upgrading from Rails 2 to 3</a></li>&#x000A;<li><a href="http://assets.en.oreilly.com/1/event/46/Rack%20in%20Rails%203%20Presentation.pdf">Ryan Tomayko talks about Rack and Rails use of Rack to become more modular and extensible</a></li>&#x000A;</ul>&#x000A;&#x000A;&#x000A;<p>Don&#8217;t forget to check out Jeremy&#8217;s upcoming <a href="http://railsupgradehandbook.com/">Rails 3 Upgrade Handbook</a> if you&#8217;re in the market for test driving all the sweetness Rails 3 has to offer.  Jeremy&#8217;s a great writer and this 120-page manual is sure to impress.</p>&#x000A;&#x000A;<p>The RailsConf program committee of <a href="http://chadfowler.com/">Chad</a> and <a href="http://benscofield.com/">Ben</a> deserves a big &#8220;thanks&#8221; for putting on the online conf.  My hope is that mini-events like this become more frequent in the future.</p>&#x000A;&#x000A;<p>If you missed out on this event and aren&#8217;t a fan of visuals, you can always <a href="http://en.oreilly.com/railswinter10/public/sv/q/216">download the audio recording</a> when it comes out.</p>&#x000A;  </div>&#x000A;  <div class="footer">&#x000A;    <a href="/archives.html" title="archives">&laquo; Blog Archives</a>&#x000A;  </div>&#x000A;</div>
          </div>
        </div>
        <div id='sidebar'>
          <div class='contents'>
            <div class='group' id='ads'>
              <div class='aside'>
                <a href='http://brandonmathis.com/' id='brandon_ad'><span style="display: none">Brandon Mathis - Design Enthusiast</span></a>
                <script type='text/javascript'>
                  //<![CDATA[
                    var images = ["brandon_mathis_1.png", "brandon_mathis_2.png", "brandon_mathis_3.png"]
                    choice = Math.floor((2)*Math.random());      
                    $("<img src='/images/"+images[choice]+"'/>").prependTo("#brandon_ad");
                  //]]>
                </script>
              </div>
              <div class='aside'>
                <div class='small'>
                  <div id='adzerk'>
                    <div id='adzerk_ad_div'>
                      <script src='http://rubyrow.net/Server/RUBY/DAIGLE/VERT' type='text/javascript'></script>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class='aside' id='er_comments'>
              <h4>Recent comments</h4>
              <div class='feed' feed='http://edgerails.disqus.com/comments.rss' id='comment_feed' template='#comment_feed_template'>
                Fetching comments...
              </div>
              <script id='comment_feed_template' type='text/html'>
                <% for ( var i = 0; i < feed.entries.length; i++ ) { %>
                  <% var entry = feed.entries[i]; %>
                  <div class="entry">
                    <%= entry.author %> said: <%= entry.contentSnippet %>
                    <div class="meta">
                      <a href="<%= entry.link %>"><%= entry.title %></a>
                    </div>
                  </div>
                <% } %>
              </script>
            </div>
            <div class='group'>
              <h4>Recent Commits</h4>
              <div class='aside' id='rails_commits'>
                <h5>Rails commits</h5>
                <div class='feed' feed='http://github.com/feeds/rails/commits/rails/master' id='rails_commit_feed' template='#rails_commit_feed_template'>
                  Fetching Rails commits...
                </div>
                <script id='rails_commit_feed_template' type='text/html'>
                  <% for ( var i = 0; i < feed.entries.length; i++ ) { %>
                    <% var entry = feed.entries[i]; %>
                    <div class="entry">
                      <%= entry.author %> <a href="<%= entry.link %>"><%= entry.title %></a>
                    </div>
                  <% } %>
                </script>
              </div>
              <div class='aside' id='er_updates'>
                <h5>EdgeRails.info updates</h5>
                <div class='feed' feed='http://github.com/feeds/rwdaigle/commits/edgerails/master' id='er_commit_feed' template='#er_commit_feed_template'>
                  Fetching EdgeRails.info updates...
                </div>
                <script id='er_commit_feed_template' type='text/html'>
                  <% for ( var i = 0; i < feed.entries.length; i++ ) { %>
                    <% var entry = feed.entries[i]; %>
                    <div class="entry">
                      <%= entry.author %> <a href="<%= entry.link %>"><%= entry.title %></a>
                    </div>
                  <% } %>
                </script>
              </div>
            </div>
            <script type='text/javascript'>
              //<![CDATA[
                $(document).ready(function() {
                  $('#edgerails_tweets').twitterize({ q: 'edgerails OR "edge rails"' });
                  $('#edgerailsinfo_tweets').twitterize({ from: 'edgerailsinfo' });
                });
              //]]>
            </script>
            <div class='aside' id='twitter'>
              <h4>
                EdgeRails.info tweets
                <span class='small'>
                  <a href='http://twitter.com/edgerailsinfo'>&gt;&gt;</a>
                </span>
              </h4>
              <div class='twitter_feed' id='edgerailsinfo_tweets' template='#tweets_template'>Loading tweets about edgerails...</div>
            </div>
            <div class='aside' id='twitter'>
              <h4>
                Edge rails tweets
                <span class='small'>
                  <a href='http://search.twitter.com/search?q=edgerails OR "edge rails"'>&gt;&gt;</a>
                </span>
              </h4>
              <div class='twitter_feed' id='edgerails_tweets' search_url='' template='#tweets_template'>Loading tweets about edgerails...</div>
              <script id='tweets_template' type='text/html'>
                <% for ( var i = 0; i < results.length; i++ ) { %>
                  <% var tweet = results[i]; %>
                  <div class="entry">
                    <p>
                      <a class="user" href="http://twitter.com/<%= tweet.from_user %>">@<%= tweet.from_user %></a>:
                      <%= tweet.text.replace(/(https?:\/\/[\w\-:;?&=+.%#\/]+)/gi,'<a href="$1">$1</a>').replace(/\n\n/gi,'</p><p>') %>
                    </p>
                    <div class="meta">
                      About
                      <a href="http://twitter.com/<%= tweet.from_user %>/statuses/<%= tweet.id %>">
                        <%= prettyDate(tweet.created_at) %>
                      </a>
                    </div>
                  </div>
                <% } %>
              </script>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="footer">
      <div class='page_width'>
        Copyright &copy; 2011 - Edge Rails.info
        <span class='credit'>
          designed by
          <a href='http://brandonmathis.com/'>Brandon Mathis</a>
          powered by
          <a href='http://octopress.org'>Octopress</a>
        </span>
      </div>
    </div>
    <script type='text/javascript'>
      //<![CDATA[
        (function() {
            var links = document.getElementsByTagName('a');
            var query = '?';
            for(var i = 0; i < links.length; i++) {
              if(links[i].href.indexOf('#disqus_thread') >= 0) {
                query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
              }
            }
            document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/edgerails/get_num_replies.js' + query + '"></' + 'script>');
          })();
      //]]>
    </script>
    <script type='text/javascript'>
      //<![CDATA[
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-77805-13']);
        _gaq.push(['_trackPageview']);
        
        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
        })();
      //]]>
    </script>
  </body>
</html>
